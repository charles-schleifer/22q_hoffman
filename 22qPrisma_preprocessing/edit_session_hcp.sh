#!/bin/bash

# C.Schleifer 8/2021
# script to edit session_hcp.txt files to only use the first T1w and T2w (without intensity normalization) and edit subject field

seshdir=/u/project/cbearden/data/22qPrisma/qunex_studyfolder/sessions/
#sessions="Q_0001_02222018 Q_0005_11072017 Q_0017_10022017 Q_0019_03022020 Q_0030_05082018 Q_0036_08082017 Q_0036_08312018 Q_0036_09302019 Q_0037_08152017 Q_0038_08192019 Q_0041_10092017 Q_0051_02032017 Q_0105_03112020 Q_0105_12032018 Q_0114_12052017 Q_0138_01082018 Q_0141_06122018 Q_0141_08052019 Q_0147_12112017 Q_0147_12112018 Q_0192_11192018 Q_0192_11202017 Q_0192_11252019 Q_0196_01082020 Q_0213_05012017 Q_0214_05012017 Q_0217_01242017 Q_0217_02192020 Q_0234_05302017 Q_0235_05252017 Q_0238_02202018 Q_0240_09192017 Q_0240_11162018 Q_0246_10092018 Q_0246_10102017 Q_0246_10142016 Q_0250_10232018 Q_0250_10242017 Q_0260_06192017 Q_0260_06242019 Q_0260_06252018 Q_0263_02252019 Q_0263_02262018 Q_0263_11072016 Q_0271_10182016 Q_0277_11302017 Q_0277_12132016 Q_0278_11292017 Q_0278_12052019 Q_0278_12132016 Q_0279_11302017 Q_0279_12052019 Q_0279_12132016 Q_0285_03212017 Q_0285_06062018 Q_0286_03212017 Q_0287_03212017 Q_0287_06062018 Q_0288_03212017 Q_0288_06062018 Q_0289_03212017 Q_0289_06062018 Q_0291_11042016 Q_0291_11302018 Q_0304_12202016 Q_0310_01252018 Q_0310_02132017 Q_0310_04292019 Q_0313_05072019 Q_0313_12132016 Q_0313_12142017 Q_0315_02162017 Q_0319_03192018 Q_0319_03282017 Q_0321_03192018 Q_0321_03272017 Q_0324_04182018 Q_0324_05032017 Q_0326_10202017 Q_0326_12062018 Q_0327_10192017 Q_0327_12072018 Q_0331_06102019 Q_0331_06212018 Q_0331_06272017 Q_0333_04142017 Q_0334_12012016 Q_0336_01102017 Q_0337_04022018 Q_0338_02162017 Q_0338_03292018 Q_0339_03292018 Q_0345_04122017 Q_0345_08152018 Q_0345_09112019 Q_0346_04102017 Q_0346_04102018 Q_0348_04212017 Q_0348_08152018 Q_0350_04192017 Q_0350_09142018 Q_0353_04182018 Q_0353_05022017 Q_0355_05312018 Q_0355_06052019 Q_0356_05312018 Q_0356_06052019 Q_0356_06062017 Q_0361_08212017 Q_0361_10212019 Q_0361_11202018 Q_0369_04182018 Q_0369_06182019 Q_0371_07312019 Q_0371_08042020 Q_0374_05152019 Q_0374_05252018 Q_0377_07242018 Q_0381_08072018 Q_0381_09102019 Q_0382_08282018 Q_0383_08282018 Q_0384_08282018 Q_0387_08242018 Q_0387_12032019 Q_0390_09042018 Q_0390_09302019 Q_0391_09252018 Q_0395_11062018 Q_0395_11062018_18 Q_0395_11062018_2 Q_0397_10172019 Q_0397_11082018 Q_0401_01112019 Q_0401_01112019_2 Q_0401_01112019_8 Q_0402_01112019 Q_0404_03112019 Q_0404_03162020 Q_0407_06122019 Q_0408_05172019 Q_0411_05202019 Q_0414_07172019 Q_0415_07292019 Q_0416_07292019 Q_0419_08132019 Q_0422_11262019 Q_0425_11052019 Q_0426_11262019 Q_0429_01092020 Q_0432_02142020 Q_0433_02262020 Q_0443_06282021 Q_0446_06152021"
#sessions="Q_0477_01052022 Q_0484_01042022 Q_0508_06232022 Q_0519_05312022 Q_0520_06012022 Q_0521_05202022 Q_0525_06072022 Q_0526_06242022 Q_0527_07112022 Q_0528_07202022 Q_0529_07202022 Q_0541_07182022 Q_0549_10182022 Q_0561_11032022 Q_0568_10252022"
cd $seshdir
sessions=Q_*

for sesh in $sessions; do
	for tn in T1w T2w; do 
		n=$(cat ${seshdir}/${sesh}/session_hcp.txt | grep $tn | wc -l)
		if [[ n -eq 2 ]]; then
			line=$(cat /u/project/cbearden/data/22qPrisma/qunex_studyfolder/sessions/${sesh}/session_hcp.txt | grep $tn | tail -n1)
			 sed -i "s/${line}/\#${line}/" ${seshdir}/${sesh}/session_hcp.txt 
			
		else
			echo "${sesh} has ${n} ${tn} images, need to manually edit session_hcp.txt"
			echo "${sesh} : ${tn} : ${n}" >> ${seshdir}/specs/check_t1_t2_for_these_sessions.txt		
		fi
	done	
	subject="Q_$(echo ${sesh} | cut -d "_" -f 2)"
	sed -i "/subject/c subject: ${subject}" ${seshdir}/${sesh}/session_hcp.txt 
done